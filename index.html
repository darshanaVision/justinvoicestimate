<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compact Invoice Generator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --secondary: #7209b7;
      --success: #4cc9f0;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --light-gray: #e9ecef;
      --border: #dee2e6;
      --danger: #e63946;
      --warning: #fca311;
      --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      --radius: 6px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .compact-controls {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.compact-controls .btn-sm {
  width: 100%;
  justify-content: center;
}

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--dark);
      line-height: 1.5;
      padding: 15px;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    h1 {
      color: var(--primary);
      font-size: 1.8rem;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    h1 i {
      color: var(--secondary);
    }

    .subtitle {
      color: var(--gray);
      font-size: 0.9rem;
    }

    .app-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 1100px) {
      .app-container {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: white;
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
    }

    .card h2 {
      color: var(--primary);
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--light-gray);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.2rem;
    }

    .card h2 i {
      color: var(--secondary);
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--dark);
      font-size: 0.9rem;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 0.9rem;
      transition: all 0.3s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
    }

    .row {
      display: flex;
      gap: 10px;
    }

    .row > * {
      flex: 1;
    }

    .compact-section {
      display: flex;
      gap: 15px;
      align-items: flex-start;
    }

    .logo-preview {
      width: 120px;
      height: 60px;
      border: 1px dashed var(--border);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--light);
      cursor: pointer;
      overflow: hidden;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .logo-preview:hover {
      border-color: var(--primary);
      background: #f0f4ff;
    }

    .logo-preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .compact-controls {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .address-section {
      display: flex;
      gap: 15px;
    }

    .address-box {
      flex: 1;
      padding: 12px;
      border-radius: var(--radius);
      background: var(--light);
      border: 1px solid var(--border);
    }

    .address-box h3 {
      margin-bottom: 8px;
      color: var(--primary);
      font-size: 0.95rem;
    }

    .address-box textarea {
      background: white;
      min-height: 80px;
      font-size: 0.85rem;
      padding: 6px 8px;
    }

    .invoice-header-compact {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .invoice-title-compact {
      text-align: right;
    }

    .invoice-title-compact h2 {
      font-size: 1.4rem;
      color: var(--primary);
      margin-bottom: 2px;
      border: none;
      padding: 0;
    }

    .invoice-title-compact p {
      font-size: 0.8rem;
      color: var(--gray);
      margin-bottom: 2px;
    }

    .items-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.85rem;
    }

    .items-table th {
      background: var(--primary);
      color: white;
      text-align: left;
      padding: 8px 10px;
      font-weight: 600;
    }

    .items-table td {
      padding: 8px 10px;
      border-bottom: 1px solid var(--border);
    }

    .items-table input {
      padding: 5px 8px;
      margin: 0;
      font-size: 0.85rem;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 8px 12px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn:hover {
      background: var(--primary-dark);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
    }

    .btn-danger:hover {
      background: #c1121f;
    }

    .btn-sm {
      padding: 5px 8px;
      font-size: 0.8rem;
    }

    .totals-section {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid var(--light-gray);
    }

    .totals-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      padding: 3px 0;
      font-size: 0.9rem;
    }

    .total {
      font-weight: 700;
      font-size: 1rem;
      color: var(--primary);
      border-top: 1px solid var(--border);
      padding-top: 8px;
    }

    .preview-container {
      position: sticky;
      top: 15px;
    }

    .preview-actions {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      align-items: center;
    }

    .invoice-preview {
      background: white;
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      min-height: 700px;
    }

    .invoice-preview-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .invoice-logo {
      max-width: 120px;
      max-height: 60px;
    }

    .invoice-title {
      text-align: right;
    }

    .invoice-title h2 {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 3px;
    }

    .invoice-addresses {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .invoice-from, .invoice-to {
      flex: 0 0 48%;
    }

    .invoice-address {
      background: var(--light);
      padding: 10px;
      border-radius: var(--radius);
      margin-top: 5px;
      white-space: pre-line;
      font-size: 0.85rem;
    }

    .invoice-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      font-size: 0.85rem;
    }

    .invoice-table th {
      background: var(--primary);
      color: white;
      padding: 8px 10px;
      text-align: left;
    }

    .invoice-table td {
      padding: 8px 10px;
      border-bottom: 1px solid var(--border);
    }

    .text-right {
      text-align: right;
    }

    .invoice-totals {
      width: 250px;
      margin-left: auto;
    }

    .invoice-totals .totals-row {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      font-size: 0.85rem;
    }

    .invoice-totals .total {
      border-top: 1px solid var(--border);
      font-size: 1rem;
    }

    .invoice-footer {
      margin-top: 30px;
      text-align: center;
      color: var(--gray);
      font-style: italic;
      font-size: 0.8rem;
    }

    .status-message {
      position: fixed;
      bottom: 15px;
      right: 15px;
      padding: 10px 15px;
      background: var(--success);
      color: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.9rem;
    }

    .status-message.show {
      opacity: 1;
    }

    .required::after {
      content: " *";
      color: var(--danger);
    }

    .empty-state {
      text-align: center;
      padding: 20px;
      color: var(--gray);
      font-size: 0.9rem;
    }

    .empty-state i {
      font-size: 2rem;
      margin-bottom: 10px;
      color: var(--light-gray);
    }

    .discount-section {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .discount-section select {
      flex: 0 0 100px;
    }

    .discount-section input {
      flex: 1;
    }

    .small-text {
      font-size: 0.75rem;
      color: var(--gray);
    }

    @media (max-width: 768px) {
      .row, .compact-section, .address-section {
        flex-direction: column;
      }
      
      .invoice-preview-header, .invoice-addresses {
        flex-direction: column;
        gap: 15px;
      }
      
      .invoice-title {
        text-align: left;
      }
      
      .invoice-totals {
        width: 100%;
      }
      
      .discount-section {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-file-invoice-dollar"></i> Compact Invoice Generator</h1>
      <p class="subtitle">Create professional invoices and estimates with a space-efficient layout</p>
    </header>

    <div class="app-container">
      <div class="card">
        <h2><i class="fas fa-cog"></i> Document Settings</h2>
        
        <div class="form-group">
          <label for="docType" class="required">Document Type</label>
          <select id="docType">
            <option value="invoice">Invoice</option>
            <option value="estimate">Estimate</option>
            <option value="quote">Quote</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Company Logo</label>
          <div class="compact-section">
            <div class="logo-preview" id="logoPreview">
              <i class="fas fa-plus"></i>
            </div>
            <div class="compact-controls">
              <button class="btn btn-outline btn-sm" id="uploadLogoBtn">
                <i class="fas fa-upload"></i> Upload Logo
              </button>
              <button class="btn btn-danger btn-sm" id="removeLogoBtn" style="display: none;">
                <i class="fas fa-trash"></i> Remove Logo
              </button>
              <p class="small-text">Recommended: 300x100px (PNG/JPG)</p>
            </div>
          </div>
          <input type="file" id="logoInput" accept="image/*" style="display: none;">
        </div>
        
        <div class="form-group">
          <label>Address Information</label>
          <div class="address-section">
            <div class="address-box">
              <h3><i class="fas fa-building"></i> From / Seller</h3>
              <textarea id="fromAddress" placeholder="Your Company Name
123 Business Street
City, State 12345
Email: contact@company.com
Phone: (123) 456-7890"></textarea>
            </div>
            <div class="address-box">
              <h3><i class="fas fa-user"></i> To / Client</h3>
              <textarea id="toAddress" placeholder="Client Company Name
456 Client Avenue
City, State 67890
Attn: John Smith
Email: john@client.com"></textarea>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="form-group">
            <label for="invoiceNumber" class="required">Document Number</label>
            <input type="text" id="invoiceNumber" value="INV-2023-001">
          </div>
          <div class="form-group">
            <label for="invoiceDate" class="required">Date</label>
            <input type="date" id="invoiceDate">
          </div>
        </div>
        
        <div class="row">
          <div class="form-group">
            <label for="currency">Currency</label>
            <select id="currency">
              <option value="USD">USD ($)</option>
              <option value="INR">INR (₹)</option>
              <option value="LKR">LKR (Rs)</option>
              <option value="EUR">EUR (€)</option>
              <option value="INR">INR (₹)</option>
              <option value="GBP">GBP (£)</option>
              <option value="JPY">JPY (¥)</option>
              <option value="CAD">CAD (C$)</option>
              <option value="AUD">AUD (A$)</option>
              <option value="CHF">CHF (CHF)</option>
              <option value="CNY">CNY (¥)</option>
              <option value="BRL">BRL (R$)</option>
              <option value="MXN">MXN ($)</option>
              <option value="SGD">SGD (S$)</option>
              <option value="NZD">NZD (NZ$)</option>
              <option value="ZAR">ZAR (R)</option>
              <option value="AED">AED (د.إ)</option>
              <option value="TRY">TRY (₺)</option>
              <option value="RUB">RUB (₽)</option>
              <option value="KRW">KRW (₩)</option>
              <option value="SEK">SEK (kr)</option>
              <option value="NOK">NOK (kr)</option>
              <option value="DKK">DKK (kr)</option>
              <option value="PLN">PLN (zł)</option>
              <option value="THB">THB (฿)</option>
              <option value="MYR">MYR (RM)</option>
              <option value="IDR">IDR (Rp)</option>
              <option value="PHP">PHP (₱)</option>
              <option value="HKD">HKD (HK$)</option>
              <option value="TWD">TWD (NT$)</option>
              <option value="VND">VND (₫)</option>
              <option value="SAR">SAR (﷼)</option>
              <option value="QAR">QAR (﷼)</option>
              <option value="KWD">KWD (د.ك)</option>
              <option value="EGP">EGP (E£)</option>
              <option value="ILS">ILS (₪)</option>
              <option value="CLP">CLP (CLP$)</option>
              <option value="COP">COP (COL$)</option>
              <option value="PEN">PEN (S/.)</option>
              <option value="ARS">ARS ($)</option>
              <option value="UAH">UAH (₴)</option>
              <option value="HUF">HUF (Ft)</option>
              <option value="CZK">CZK (Kč)</option>
              <option value="RON">RON (lei)</option>
              <option value="BGN">BGN (лв)</option>
              <option value="HRK">HRK (kn)</option>
              <option value="ISK">ISK (kr)</option>
              
            </select>
          </div>
          <div class="form-group">
            <label for="taxRate">Tax Rate (%)</label>
            <input type="number" id="taxRate" placeholder="0" min="0" max="100">
          </div>
        </div>
        
        <div class="form-group">
          <label for="discount">Discount</label>
          <div class="discount-section">
            <select id="discountType">
              <option value="percent">%</option>
              <option value="fixed">Fixed</option>
            </select>
            <input type="number" id="discount" placeholder="0" min="0" step="0.01">
          </div>
        </div>
        
        <h2><i class="fas fa-list"></i> Line Items</h2>
        
        <table class="items-table">
          <thead>
            <tr>
              <th style="width: 40%">Description</th>
              <th style="width: 15%">Qty</th>
              <th style="width: 20%">Unit Price</th>
              <th style="width: 15%">Amount</th>
              <th style="width: 10%"></th>
            </tr>
          </thead>
          <tbody id="itemsTableBody">
            <tr>
              <td><input type="text" class="item-desc" placeholder="Item description"></td>
              <td><input type="number" class="item-qty" placeholder="0" min="0"></td>
              <td><input type="number" class="item-price" placeholder="0.00" min="0" step="0.01"></td>
              <td class="item-total">$0.00</td>
              <td><button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button></td>
            </tr>
            <tr>
              <td><input type="text" class="item-desc" placeholder="Item description"></td>
              <td><input type="number" class="item-qty" placeholder="0" min="0"></td>
              <td><input type="number" class="item-price" placeholder="0.00" min="0" step="0.01"></td>
              <td class="item-total">$0.00</td>
              <td><button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button></td>
            </tr>
          </tbody>
        </table>
        
        <div class="form-group" style="margin-top: 10px;">
          <button class="btn btn-outline" id="addItemBtn">
            <i class="fas fa-plus"></i> Add Item
          </button>
        </div>
        
        <div class="totals-section">
          <div class="totals-row">
            <span>Subtotal:</span>
            <span id="subtotal">$0.00</span>
          </div>
          <div class="totals-row">
            <span>Discount:</span>
            <span id="discountAmount">$0.00</span>
          </div>
          <div class="totals-row">
            <span>Tax (<span id="taxPercent">0</span>%):</span>
            <span id="taxAmount">$0.00</span>
          </div>
          <div class="totals-row total">
            <span>Total:</span>
            <span id="totalAmount">$0.00</span>
          </div>
        </div>
        
        <div class="form-group" style="margin-top: 15px;">
          <button class="btn" id="saveInvoiceBtn" style="width: 100%;">
            <i class="fas fa-save"></i> Save Document
          </button>
        </div>
      </div>
      
      <div class="preview-container">
        <div class="preview-actions">
          <h2><i class="fas fa-eye"></i> Live Preview</h2>
          <button class="btn" id="downloadPdfBtn">
            <i class="fas fa-file-pdf"></i> Download PDF
          </button>
        </div>
        
        <div class="invoice-preview card">
          <div class="invoice-preview-header">
            <div class="invoice-logo-container">
              <img src="" alt="Company Logo" class="invoice-logo" id="previewLogo" style="display: none;">
              <div id="noLogo" class="empty-state">
                <i class="fas fa-image"></i>
                <p>No logo uploaded</p>
              </div>
            </div>
            <div class="invoice-title">
              <h2 id="previewDocType">INVOICE</h2>
              <p>Number: <span id="previewInvoiceNumber">INV-2023-001</span></p>
              <p>Date: <span id="previewDate">October 15, 2023</span></p>
            </div>
          </div>
          
          <div class="invoice-addresses">
            <div class="invoice-from">
              <h3>From:</h3>
              <div class="invoice-address" id="previewFromAddress">
                Your Company Name
                123 Business Street
                City, State 12345
                Email: contact@company.com
                Phone: (123) 456-7890
              </div>
            </div>
            <div class="invoice-to">
              <h3>To:</h3>
              <div class="invoice-address" id="previewToAddress">
                Client Company Name
                456 Client Avenue
                City, State 67890
                Attn: John Smith
                Email: john@client.com
              </div>
            </div>
          </div>
          
          <table class="invoice-table">
            <thead>
              <tr>
                <th style="width: 40%">Description</th>
                <th style="width: 15%">Qty</th>
                <th style="width: 20%">Unit Price</th>
                <th style="width: 25%" class="text-right">Amount</th>
              </tr>
            </thead>
            <tbody id="previewItems">
              <tr>
                <td colspan="4" style="text-align: center; color: var(--gray); padding: 20px;">
                  No items added yet
                </td>
              </tr>
            </tbody>
          </table>
          
          <div class="invoice-totals">
            <div class="totals-row">
              <span>Subtotal:</span>
              <span id="previewSubtotal">$0.00</span>
            </div>
            <div class="totals-row">
              <span>Discount:</span>
              <span id="previewDiscount">$0.00</span>
            </div>
            <div class="totals-row">
              <span>Tax (<span id="previewTaxPercent">0</span>%):</span>
              <span id="previewTax">$0.00</span>
            </div>
            <div class="totals-row total">
              <span>Total:</span>
              <span id="previewTotal">$0.00</span>
            </div>
          </div>
          
          <div class="invoice-footer">
            <p>Thank you for your business!</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="status-message" id="statusMessage">
    <i class="fas fa-check-circle"></i>
    <span>Invoice saved successfully!</span>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Set current date as default
      const today = new Date();
      document.getElementById('invoiceDate').valueAsDate = today;
      document.getElementById('previewDate').textContent = formatDate(today);
      
      // Logo handling
const logoInput = document.getElementById('logoInput');
const logoPreview = document.getElementById('logoPreview');
const uploadLogoBtn = document.getElementById('uploadLogoBtn');
const removeLogoBtn = document.getElementById('removeLogoBtn');
const previewLogo = document.getElementById('previewLogo');
const noLogo = document.getElementById('noLogo');

uploadLogoBtn.addEventListener('click', () => logoInput.click());

logoInput.addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      logoPreview.innerHTML = `<img src="${e.target.result}" alt="Logo">`;
      previewLogo.src = e.target.result;
      previewLogo.style.display = 'block';
      noLogo.style.display = 'none';
      removeLogoBtn.style.display = 'inline-flex';
    };
    reader.readAsDataURL(file);
  }
});

// Remove logo functionality
removeLogoBtn.addEventListener('click', function() {
  // Reset logo preview
  logoPreview.innerHTML = '<i class="fas fa-plus"></i>';
  
  // Reset file input
  logoInput.value = '';
  
  // Hide logo in preview
  previewLogo.style.display = 'none';
  noLogo.style.display = 'block';
  
  // Hide remove button
  removeLogoBtn.style.display = 'none';
});
      
      // Add item functionality
      const addItemBtn = document.getElementById('addItemBtn');
      const itemsTableBody = document.getElementById('itemsTableBody');
      
      addItemBtn.addEventListener('click', function() {
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
          <td><input type="text" class="item-desc" placeholder="Item description"></td>
          <td><input type="number" class="item-qty" placeholder="0" min="0"></td>
          <td><input type="number" class="item-price" placeholder="0.00" min="0" step="0.01"></td>
          <td class="item-total">$0.00</td>
          <td><button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button></td>
        `;
        itemsTableBody.appendChild(newRow);
        
        // Add event listeners to new inputs
        const descInput = newRow.querySelector('.item-desc');
        const qtyInput = newRow.querySelector('.item-qty');
        const priceInput = newRow.querySelector('.item-price');
        const deleteBtn = newRow.querySelector('.btn');
        
        descInput.addEventListener('input', updatePreview);
        qtyInput.addEventListener('input', updateItemTotal);
        priceInput.addEventListener('input', updateItemTotal);
        deleteBtn.addEventListener('click', function() {
          newRow.remove();
          updateTotals();
          updatePreview();
        });
        
        updateItemTotal.call(priceInput);
      });
      
      // Set up event listeners for existing items
      document.querySelectorAll('.item-desc').forEach(input => {
        input.addEventListener('input', updatePreview);
      });
      
      document.querySelectorAll('.item-qty, .item-price').forEach(input => {
        input.addEventListener('input', updateItemTotal);
      });
      
      document.querySelectorAll('.btn-danger').forEach(btn => {
        btn.addEventListener('click', function() {
          this.closest('tr').remove();
          updateTotals();
          updatePreview();
        });
      });
      
      // Update item total when quantity or price changes
      function updateItemTotal() {
        const row = this.closest('tr');
        const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
        const price = parseFloat(row.querySelector('.item-price').value) || 0;
        const total = qty * price;
        row.querySelector('.item-total').textContent = formatCurrency(total);
        
        updateTotals();
        updatePreview();
      }
      
      // Update all totals
      function updateTotals() {
        let subtotal = 0;
        
        document.querySelectorAll('.item-total').forEach(cell => {
          const value = parseFloat(cell.textContent.replace(/[^0-9.-]+/g,"")) || 0;
          subtotal += value;
        });
        
        const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
        const discountValue = parseFloat(document.getElementById('discount').value) || 0;
        const discountType = document.getElementById('discountType').value;
        
        let discountAmount = 0;
        if (discountType === 'percent') {
          discountAmount = subtotal * (discountValue / 100);
        } else {
          discountAmount = discountValue;
        }
        
        const taxableAmount = subtotal - discountAmount;
        const taxAmount = taxableAmount * (taxRate / 100);
        const total = taxableAmount + taxAmount;
        
        document.getElementById('subtotal').textContent = formatCurrency(subtotal);
        document.getElementById('discountAmount').textContent = formatCurrency(discountAmount);
        document.getElementById('taxAmount').textContent = formatCurrency(taxAmount);
        document.getElementById('totalAmount').textContent = formatCurrency(total);
        document.getElementById('taxPercent').textContent = taxRate;
      }
      
      // Update preview
      function updatePreview() {
        // Update document type
        const docType = document.getElementById('docType').value;
        document.getElementById('previewDocType').textContent = docType.toUpperCase();
        
        // Update addresses - use empty string if no input
      const fromAddress = document.getElementById('fromAddress').value;
      document.getElementById('previewFromAddress').textContent = fromAddress || "";

      const toAddress = document.getElementById('toAddress').value;
      document.getElementById('previewToAddress').textContent = toAddress || "";
        
        // Update invoice number and date
        const invoiceNumber = document.getElementById('invoiceNumber').value;
        document.getElementById('previewInvoiceNumber').textContent = invoiceNumber;
        
        const invoiceDate = new Date(document.getElementById('invoiceDate').value);
        document.getElementById('previewDate').textContent = formatDate(invoiceDate);
        
        // Update items in preview
        const previewItems = document.getElementById('previewItems');
        previewItems.innerHTML = '';
        
        let subtotal = 0;
        let hasItems = false;
        
        document.querySelectorAll('#itemsTableBody tr').forEach(row => {
          const desc = row.querySelector('.item-desc').value;
          const qty = row.querySelector('.item-qty').value || 0;
          const price = parseFloat(row.querySelector('.item-price').value) || 0;
          
          if (desc || qty > 0 || price > 0) {
            hasItems = true;
            const total = parseFloat(qty) * price;
            subtotal += total;
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
              <td>${desc || 'Item description'}</td>
              <td>${qty}</td>
              <td>${formatCurrency(price)}</td>
              <td class="text-right">${formatCurrency(total)}</td>
            `;
            previewItems.appendChild(newRow);
          }
        });
        
        if (!hasItems) {
          previewItems.innerHTML = `
            <tr>
              <td colspan="4" style="text-align: center; color: var(--gray); padding: 20px;">
                No items added yet
              </td>
            </tr>
          `;
        }
        
        // Update totals in preview
        const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
        const discountValue = parseFloat(document.getElementById('discount').value) || 0;
        const discountType = document.getElementById('discountType').value;
        
        let discountAmount = 0;
        if (discountType === 'percent') {
          discountAmount = subtotal * (discountValue / 100);
        } else {
          discountAmount = discountValue;
        }
        
        const taxableAmount = subtotal - discountAmount;
        const taxAmount = taxableAmount * (taxRate / 100);
        const total = taxableAmount + taxAmount;
        
        document.getElementById('previewSubtotal').textContent = formatCurrency(subtotal);
        document.getElementById('previewDiscount').textContent = formatCurrency(discountAmount);
        document.getElementById('previewTax').textContent = formatCurrency(taxAmount);
        document.getElementById('previewTotal').textContent = formatCurrency(total);
        document.getElementById('previewTaxPercent').textContent = taxRate;
      }
      
      // Format currency
function formatCurrency(amount) {
  const currency = document.getElementById('currency').value;
  const symbols = {
    'USD': '$', 'EUR': '€', 'GBP': '£', 'JPY': '¥', 'CAD': 'C$',
    'AUD': 'A$', 'CHF': 'CHF', 'CNY': '¥', 'INR': '₹', 'BRL': 'R$',
    'MXN': '$', 'SGD': 'S$', 'NZD': 'NZ$', 'ZAR': 'R', 'AED': 'د.إ',
    'TRY': '₺', 'RUB': '₽', 'KRW': '₩', 'SEK': 'kr', 'NOK': 'kr',
    'DKK': 'kr', 'PLN': 'zł', 'THB': '฿', 'MYR': 'RM', 'IDR': 'Rp',
    'PHP': '₱', 'HKD': 'HK$', 'TWD': 'NT$', 'VND': '₫', 'SAR': '﷼',
    'QAR': '﷼', 'KWD': 'د.ك', 'EGP': 'E£', 'ILS': '₪', 'CLP': 'CLP$',
    'COP': 'COL$', 'PEN': 'S/.', 'ARS': '$', 'UAH': '₴', 'HUF': 'Ft',
    'CZK': 'Kč', 'RON': 'lei', 'BGN': 'лв', 'HRK': 'kn', 'ISK': 'kr',
    'LKR': 'Rs'
  };
  const symbol = symbols[currency] || '$';
  
  // Special formatting for some currencies
  if (currency === 'JPY' || currency === 'KRW' || currency === 'VND' || currency === 'IDR') {
    // These currencies typically don't use decimal places
    return `${symbol}${amount.toFixed(0)}`;
  }
  
  return `${symbol}${amount.toFixed(2)}`;
}
      
      // Format date
      function formatDate(date) {
        if (!(date instanceof Date) || isNaN(date)) {
          return 'Invalid Date';
        }
        
        const options = { year: 'numeric', month: 'short', day: 'numeric' };
        return date.toLocaleDateString('en-US', options);
      }
      
      // Save invoice
      document.getElementById('saveInvoiceBtn').addEventListener('click', function() {
        const statusMessage = document.getElementById('statusMessage');
        statusMessage.classList.add('show');
        
        setTimeout(() => {
          statusMessage.classList.remove('show');
        }, 3000);
      });
      
     // Download PDF
document.getElementById('downloadPdfBtn').addEventListener('click', function() {
  generatePDF();
});

function generatePDF() {
  const { jsPDF } = window.jspdf;
  
  // Show loading state
  const originalText = this.innerHTML;
  this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
  this.disabled = true;
  
  // Capture the invoice preview
  const invoiceElement = document.querySelector('.invoice-preview');
  
  html2canvas(invoiceElement, {
    scale: 2, // Higher quality
    useCORS: true,
    logging: false,
    backgroundColor: '#ffffff'
  }).then(canvas => {
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p', 'mm', 'a4');
    const imgWidth = 210; // A4 width in mm
    const pageHeight = 295; // A4 height in mm
    const imgHeight = canvas.height * imgWidth / canvas.width;
    let heightLeft = imgHeight;
    let position = 0;
    
    // Add first page
    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
    heightLeft -= pageHeight;
    
    // Add additional pages if needed
    while (heightLeft >= 0) {
      position = heightLeft - imgHeight;
      pdf.addPage();
      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;
    }
    
    // Get document details for filename
    const docType = document.getElementById('docType').value;
    const invoiceNumber = document.getElementById('invoiceNumber').value || 'document';
    const filename = `${docType}_${invoiceNumber}.pdf`;
    
    // Download the PDF
    pdf.save(filename);
    
    // Reset button state
    this.innerHTML = originalText;
    this.disabled = false;
    
    // Show success message
    showStatusMessage('PDF downloaded successfully!', 'success');
  }).catch(error => {
    console.error('Error generating PDF:', error);
    
    // Reset button state
    this.innerHTML = originalText;
    this.disabled = false;
    
    // Show error message
    showStatusMessage('Error generating PDF. Please try again.', 'error');
  });
}

// Enhanced status message function
function showStatusMessage(message, type = 'success') {
  const statusMessage = document.getElementById('statusMessage');
  const icon = statusMessage.querySelector('i');
  
  // Update message and style based on type
  statusMessage.querySelector('span').textContent = message;
  
  if (type === 'error') {
    statusMessage.style.background = 'var(--danger)';
    icon.className = 'fas fa-exclamation-circle';
  } else {
    statusMessage.style.background = 'var(--success)';
    icon.className = 'fas fa-check-circle';
  }
  
  statusMessage.classList.add('show');
  
  setTimeout(() => {
    statusMessage.classList.remove('show');
  }, 3000);
}
      
      // Set up event listeners for form changes
      document.getElementById('docType').addEventListener('change', updatePreview);
      document.getElementById('fromAddress').addEventListener('input', updatePreview);
      document.getElementById('toAddress').addEventListener('input', updatePreview);
      document.getElementById('invoiceNumber').addEventListener('input', updatePreview);
      document.getElementById('invoiceDate').addEventListener('change', updatePreview);
      document.getElementById('currency').addEventListener('change', function() {
        updateTotals();
        updatePreview();
      });
      document.getElementById('taxRate').addEventListener('input', function() {
        updateTotals();
        updatePreview();
      });
      document.getElementById('discount').addEventListener('input', function() {
        updateTotals();
        updatePreview();
      });
      document.getElementById('discountType').addEventListener('change', function() {
        updateTotals();
        updatePreview();
      });
      
      // Initialize the preview
      updatePreview();
      updateTotals();
    });
  </script>
</body>
</html>